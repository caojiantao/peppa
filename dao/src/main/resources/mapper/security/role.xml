<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- namespace用作标识mapper的唯一，通常包名+文件名 -->
<mapper namespace="com.cjt.dao.security.IRoleDAO">
  <resultMap id="roleMap" type="com.cjt.entity.security.Role">
    <id column="id" property="id"/>
    <result column="name" property="name"/>
  </resultMap>

  <sql id="selectRole">
    SELECT
      `id`,
      `name`
    FROM
      role
  </sql>

  <select id="listRoleByUserId" resultMap="roleMap" parameterType="long">
    <include refid="selectRole"/>
    WHERE
    id IN (
    SELECT role_id
    FROM
    user_roles
    WHERE
    user_id = #{userId}
    )
  </select>

  <select id="listRole" resultMap="roleMap" parameterType="com.cjt.common.dto.RoleDTO">
    <include refid="selectRole"/>
    <trim prefix="WHERE" prefixOverrides="AND">
      <if test="name!=null">AND `name` like CONCAT('%',#{name},'%')</if>
    </trim>
    LIMIT #{start}, #{offset}
  </select>

  <select id="countRole" resultType="int" parameterType="com.cjt.common.dto.RoleDTO">
    SELECT COUNT(*)
    <trim prefix="WHERE" prefixOverrides="AND">
      <if test="name!=null">AND `name` like CONCAT('%',#{name},'%')</if>
    </trim>
    FROM role
  </select>

  <select id="getRoleById" resultMap="roleMap" parameterType="int">
    <include refid="selectRole"/>
    WHERE id = #{id}
  </select>
</mapper>